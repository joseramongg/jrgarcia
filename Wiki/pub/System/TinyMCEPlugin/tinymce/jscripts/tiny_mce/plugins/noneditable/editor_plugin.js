!function(){var e=tinymce.dom.TreeWalker,t="contenteditable",n="data-mce-"+t,r=tinymce.VK;tinymce.create("tinymce.plugins.NonEditablePlugin",{init:function(i,o){function a(e,t){var n=d.length,r=t.content,i=tinymce.trim(f);if("raw"!=t.format){for(;n--;)r=r.replace(d[n],function(t){var n=arguments,o=n[n.length-2];return o>0&&'"'==r.charAt(o-1)?t:'<span class="'+i+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode("string"==typeof n[1]?n[1]:n[0])+"</span>"});t.content=r}}var l,f,d;l=" "+tinymce.trim(i.getParam("noneditable_editable_class","mceEditable"))+" ",f=" "+tinymce.trim(i.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",(d=i.getParam("noneditable_regexp"))&&!d.length&&(d=[d]),i.onPreInit.add(function(){!function(t){function i(e){var t;if(1===e.nodeType){if((t=e.getAttribute(n))&&"inherit"!==t)return t;if("inherit"!==(t=e.contentEditable))return t}return null}function o(e){for(var t;e;){if(t=i(e))return"false"===t?e:null;e=e.parentNode}}function a(e){for(;e;){if(e.id===g)return e;e=e.parentNode}}function l(t){var n;if(t)for(t=(n=new e(t,t)).current();t;t=n.next())if(3===t.nodeType)return t}function f(e,n){var r,o;if("false"!==i(e)||!u.isBlock(e))return o=u.createRng(),"true"===i(e)&&(e.firstChild||e.appendChild(t.getDoc().createTextNode("Â ")),e=e.firstChild,n=!0),r=u.create("span",{id:g,"data-mce-bogus":!0},m),n?e.parentNode.insertBefore(r,e):u.insertAfter(r,e),o.setStart(r.firstChild,1),o.collapse(!0),s.setRng(o),r;s.select(e)}function d(e){var t,n,r;if(e)rng=s.getRng(!0),rng.setStartBefore(e),rng.setEndBefore(e),(t=l(e))&&t.nodeValue.charAt(0)==m&&(t=t.deleteData(0,1)),u.remove(e,!0),s.setRng(rng);else for(n=a(s.getStart());(e=u.get(g))&&e!==r;)n!==e&&((t=l(e))&&t.nodeValue.charAt(0)==m&&(t=t.deleteData(0,1)),u.remove(e,!0)),r=e}function c(){function t(t,n){var r,o,a,f,d;if(r=l.startContainer,o=l.startOffset,3==r.nodeType){if(d=r.nodeValue.length,o>0&&o<d||(n?o==d:0==o))return}else{if(!(o<r.childNodes.length))return n?null:t;var c=!n&&o>0?o-1:o;(r=r.childNodes[c]).hasChildNodes()&&(r=r.firstChild)}for(a=new e(r,t);f=a[n?"prev":"next"]();){if(3===f.nodeType&&f.nodeValue.length>0)return;if("true"===i(f))return f}return t}var n,r,a,l,c;d(),a=s.isCollapsed(),n=o(s.getStart()),r=o(s.getEnd()),(n||r)&&(l=s.getRng(!0),a?(n=n||r,s.getStart(),(c=t(n,!0))?f(c,!0):(c=t(n,!1))?f(c,!1):s.select(n)):(l=s.getRng(!0),n&&l.setStartBefore(n),r&&l.setEndAfter(r),s.setRng(l)))}var u=t.dom,s=t.selection,g="mce_noneditablecaret",m="\ufeff";t.onMouseDown.addToTop(function(e,t){var n=e.selection.getNode();"false"===i(n)&&n==t.target&&c()}),t.onMouseUp.addToTop(c),t.onKeyDown.addToTop(function(t,n){function l(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function f(e,t){s.select(e),s.collapse(t)}var g,m,p,v,y=n.keyCode;if(p=s.getStart(),v=s.getEnd(),(g=o(p)||o(v))&&(y<112||y>124)&&y!=r.DELETE&&y!=r.BACKSPACE){if((tinymce.isMac?n.metaKey:n.ctrlKey)&&(67==y||88==y||86==y))return;if(n.preventDefault(),y==r.LEFT||y==r.RIGHT){var E=y==r.LEFT;if(t.dom.isBlock(g)){var h=E?g.previousSibling:g.nextSibling,T=new e(h,h);f(E?T.prev():T.next(),!E)}else f(g,E)}}else if(y==r.LEFT||y==r.RIGHT||y==r.BACKSPACE||y==r.DELETE){if(m=a(p)){if(y==r.LEFT||y==r.BACKSPACE)if((g=l(m,!0))&&"false"===i(g)){if(n.preventDefault(),y!=r.LEFT)return void u.remove(g);f(g,!0)}else d(m);if(y==r.RIGHT||y==r.DELETE)if((g=l(m))&&"false"===i(g)){if(n.preventDefault(),y!=r.RIGHT)return void u.remove(g);f(g,!1)}else d(m)}if((y==r.BACKSPACE||y==r.DELETE)&&!function(e){function n(e){for(var t=l;t;){if(t===e)return;t=t.parentNode}u.remove(e),c()}var r,l,f,d;if(s.isCollapsed()){if(r=s.getRng(!0),l=r.startContainer,f=r.startOffset,l=a(l)||l,d=o(l))return n(d),!1;if(3==l.nodeType&&(e?f>0:f<l.nodeValue.length))return!0;if(1==l.nodeType&&(l=l.childNodes[f]||l),function(){var r,a,f=t.schema.getNonEmptyElements();for(a=new tinymce.dom.TreeWalker(l,t.getBody());(r=e?a.prev():a.next())&&!f[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===i(r))return n(r),!0;return!!o(r)}())return!1}return!0}(y==r.BACKSPACE))return n.preventDefault(),!1}}),t.onKeyUp.addToTop(c)}(i),d&&(i.selection.onBeforeSetContent.add(a),i.onBeforeSetContent.add(a)),i.parser.addAttributeFilter("class",function(e){for(var t,r,i=e.length;i--;)-1!==(t=" "+(r=e[i]).attr("class")+" ").indexOf(l)?r.attr(n,"true"):-1!==t.indexOf(f)&&r.attr(n,"false")}),i.serializer.addAttributeFilter(n,function(e,r){for(var i,o=e.length;o--;)i=e[o],d&&i.attr("data-mce-content")?(i.name="#text",i.type=3,i.raw=!0,i.value=i.attr("data-mce-content")):(i.attr(t,null),i.attr(n,null))}),i.parser.addAttributeFilter(t,function(e,r){for(var i,o=e.length;o--;)(i=e[o]).attr(n,i.attr(t)),i.attr(t,null)})})},getInfo:function(){return{longname:"Non editable elements",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/noneditable",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("noneditable",tinymce.plugins.NonEditablePlugin)}();
