!function(e){function t(e,t){return parseInt(e.getAttribute(t)||1)}function n(n,l,r){function a(e,t){return(e=e.cloneNode(t)).removeAttribute("id"),e}function c(){var e=0;w=[],o(["thead","tbody","tfoot"],function(r){var a=l.select("> "+r+" tr",n);o(a,function(n,a){a+=e,o(l.select("> td, > th",n),function(e,n){var o,l,c,i;if(w[a])for(;w[a][n];)n++;for(c=t(e,"rowspan"),i=t(e,"colspan"),l=a;l<a+c;l++)for(w[l]||(w[l]=[]),o=n;o<n+i;o++)w[l][o]={part:r,real:l==a&&o==n,elm:e,rowspan:c,colspan:i}})}),e+=a.length})}function d(e,t){var n;if(n=w[t])return n[e]}function s(e,t,n){e&&(1===(n=parseInt(n))?e.removeAttribute(t,1):e.setAttribute(t,n,1))}function f(e){return e&&(l.hasClass(e.elm,"mceSelected")||e==C)}function u(){var e=[];return o(n.rows,function(t){o(t.cells,function(n){if(l.hasClass(n,"mceSelected")||n==C.elm)return e.push(t),!1})}),e}function m(t){var n;return e.walk(t,function(r){var c;if(3==r.nodeType)return o(l.getParents(r.parentNode,null,t).reverse(),function(e){e=a(e,!1),n?c&&c.appendChild(e):n=c=e,c=e}),c&&(c.innerHTML=e.isIE&&!e.isIE11?"&nbsp;":'<br data-mce-bogus="1" />'),!1},"childNodes"),t=a(t,!1),s(t,"rowSpan",1),s(t,"colSpan",1),n?t.appendChild(n):e.isIE&&!e.isIE11||(t.innerHTML='<br data-mce-bogus="1" />'),t}function b(){var e=l.createRng();if(o(l.select("tr",n),function(e){0==e.cells.length&&l.remove(e)}),0==l.select("tr",n).length)return e.setStartAfter(n),e.setEndAfter(n),r.setRng(e),void l.remove(n);o(l.select("thead,tbody,tfoot",n),function(e){0==e.rows.length&&l.remove(e)}),c(),row=w[Math.min(w.length-1,v.y)],row&&(r.select(row[Math.min(row.length-1,v.x)].elm,!0),r.collapse(!0))}function g(e,t,n,o){var r,a,c,i,d;for(r=w[t][e].elm.parentNode,c=1;c<=n;c++)if(r=l.getNext(r,"tr")){for(a=e;a>=0;a--)if((d=w[t+c][a].elm).parentNode==r){for(i=1;i<=o;i++)l.insertAfter(m(d),d);break}if(-1==a)for(i=1;i<=o;i++)r.insertBefore(m(r.cells[0]),r.cells[0])}}function p(){o(w,function(e,n){o(e,function(e,o){var r,a,c;if(f(e)&&(e=e.elm,r=t(e,"colspan"),a=t(e,"rowspan"),r>1||a>1)){for(s(e,"rowSpan",1),s(e,"colSpan",1),c=0;c<r-1;c++)l.insertAfter(m(e),e);g(o,n,a-1,r)}})})}function h(e){var t;return o(w,function(n,l){return o(n,function(n,o){if(n.elm==e)return t={x:o,y:l},!1}),!t}),t}var w,v,_,C;c(),(C=l.getParent(r.getStart(),"th,td"))&&(v=h(C),_=function(){var e,t;return e=t=0,o(w,function(n,l){o(n,function(n,o){var r,a;f(n)&&(n=w[l][o],o>e&&(e=o),l>t&&(t=l),n.real&&(r=n.colspan-1,a=n.rowspan-1,r&&o+r>e&&(e=o+r),a&&l+a>t&&(t=l+a)))})}),{x:e,y:t}}(),C=d(v.x,v.y)),e.extend(this,{deleteTable:function(){var e=l.createRng();e.setStartAfter(n),e.setEndAfter(n),r.setRng(e),l.remove(n)},split:p,merge:function(t,n,r){var a,i,u,m,g,C,T,S,y,R;if(t?(pos=h(t),u=(a=pos.x)+(n-1),m=(i=pos.y)+(r-1)):(v=_=null,o(w,function(e,t){o(e,function(e,n){f(e)&&(v||(v={x:n,y:t}),_={x:n,y:t})})}),a=v.x,i=v.y,u=_.x,m=_.y),T=d(a,i),S=d(u,m),T&&S&&T.part==S.part){for(p(),c(),s(T=d(a,i).elm,"colSpan",u-a+1),s(T,"rowSpan",m-i+1),C=i;C<=m;C++)for(g=a;g<=u;g++)w[C]&&w[C][g]&&(t=w[C][g].elm)!=T&&(y=e.grep(t.childNodes),o(y,function(e){T.appendChild(e)}),y.length&&(y=e.grep(T.childNodes),R=0,o(y,function(e){"BR"==e.nodeName&&l.getAttrib(e,"data-mce-bogus")&&R++<y.length-1&&T.removeChild(e)})),l.remove(t));b()}},insertRow:function(e){var n,r,c,i,d,u,b,g,p;for(o(w,function(t,l){if(o(t,function(t,o){if(f(t)&&(t=t.elm,d=t.parentNode,u=a(d,!1),n=l,e))return!1}),e)return!n}),i=0;i<w[0].length;i++)if(w[n][i]&&(r=w[n][i].elm)!=c){if(e){if(n>0&&w[n-1][i]&&(g=w[n-1][i].elm,(p=t(g,"rowSpan"))>1)){s(g,"rowSpan",p+1);continue}}else if((p=t(r,"rowspan"))>1){s(r,"rowSpan",p+1);continue}s(b=m(r),"colSpan",r.colSpan),u.appendChild(b),c=r}u.hasChildNodes()&&(e?d.parentNode.insertBefore(u,d):l.insertAfter(u,d))},insertCol:function(e){var n,r;o(w,function(t,l){if(o(t,function(t,o){if(f(t)&&(n=o,e))return!1}),e)return!n}),o(w,function(o,a){var c,i,d;o[n]&&(c=o[n].elm)!=r&&(d=t(c,"colspan"),i=t(c,"rowspan"),1==d?e?(c.parentNode.insertBefore(m(c),c),g(n,a,i-1,d)):(l.insertAfter(m(c),c),g(n,a,i-1,d)):s(c,"colSpan",c.colSpan+1),r=c)})},deleteCols:function(){var n=[];o(w,function(r,a){o(r,function(r,a){f(r)&&-1===e.inArray(n,a)&&(o(w,function(e){var n,o=e[a].elm;(n=t(o,"colSpan"))>1?s(o,"colSpan",n-1):l.remove(o)}),n.push(a))})}),b()},deleteRows:function(){var e;e=u(),o(e.reverse(),function(e){!function(e){var n,r;l.getNext(e,"tr"),o(e.cells,function(e){var o=t(e,"rowSpan");o>1&&(s(e,"rowSpan",o-1),g((n=h(e)).x,n.y,1,1))}),n=h(e.cells[0]),o(w[n.y],function(e){var n;(e=e.elm)!=r&&((n=t(e,"rowSpan"))<=1?l.remove(e):s(e,"rowSpan",n-1),r=e)})}(e)}),b()},cutRows:function(){var e=u();return l.remove(e),b(),e},copyRows:function(){var e=u();return o(e,function(t,n){e[n]=a(t,!0)}),e},pasteRows:function(e,t){if(e){var n=u(),r=n[t?0:n.length-1],a=r.cells.length;o(w,function(e){var t;if(a=0,o(e,function(e,n){e.real&&(a+=e.colspan),e.elm.parentNode==r&&(t=1)}),t)return!1}),t||e.reverse(),o(e,function(e){var n,o=e.cells.length;for(i=0;i<o;i++)s(n=e.cells[i],"colSpan",1),s(n,"rowSpan",1);for(i=o;i<a;i++)e.appendChild(m(e.cells[o-1]));for(i=a;i<o;i++)l.remove(e.cells[i]);t?r.parentNode.insertBefore(e,r):l.insertAfter(e,r)}),l.removeClass(l.select("td.mceSelected,th.mceSelected"),"mceSelected")}},getPos:h,setStartCell:function(e){v=h(e)},setEndCell:function(e){var t,n,o,r,a,c,i,d;if(_=h(e),v&&_){for(t=Math.min(v.x,_.x),n=Math.min(v.y,_.y),a=o=Math.max(v.x,_.x),c=r=Math.max(v.y,_.y),y=n;y<=c;y++)(e=w[y][t]).real||t-(e.colspan-1)<t&&(t-=e.colspan-1);for(x=t;x<=a;x++)(e=w[n][x]).real||n-(e.rowspan-1)<n&&(n-=e.rowspan-1);for(y=n;y<=r;y++)for(x=t;x<=o;x++)(e=w[y][x]).real&&(i=e.colspan-1,d=e.rowspan-1,i&&x+i>a&&(a=x+i),d&&y+d>c&&(c=y+d));for(l.removeClass(l.select("td.mceSelected,th.mceSelected"),"mceSelected"),y=n;y<=c;y++)for(x=t;x<=a;x++)w[y][x]&&l.addClass(w[y][x].elm,"mceSelected")}}})}var o=e.each;e.create("tinymce.plugins.TablePlugin",{init:function(l,r){function a(e){var t=l.selection,o=l.dom.getParent(e||t.getNode(),"table");if(o)return new n(o,l.dom,t)}function c(){l.getBody().style.webkitUserSelect="",s&&(l.dom.removeClass(l.dom.select("td.mceSelected,th.mceSelected"),"mceSelected"),s=!1)}var i,d,s=!0;o([["table","table.desc","mceInsertTable",!0],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",!0],["cell_props","table.cell_desc","mceTableCellProps",!0],["split_cells","table.split_cells_desc","mceTableSplitCells",!0],["merge_cells","table.merge_cells_desc","mceTableMergeCells",!0]],function(e){l.addButton(e[0],{title:e[1],cmd:e[2],ui:e[3]})}),e.isIE||l.onClick.add(function(e,t){"TABLE"===(t=t.target).nodeName&&(e.selection.select(t),e.nodeChanged())}),l.onPreProcess.add(function(e,t){var n,o,l,r,a=e.dom;for(o=(n=a.select("table",t.node)).length;o--;)l=n[o],a.setAttrib(l,"data-mce-style",""),(r=a.getAttrib(l,"width"))&&(a.setStyle(l,"width",r),a.setAttrib(l,"width","")),(r=a.getAttrib(l,"height"))&&(a.setStyle(l,"height",r),a.setAttrib(l,"height",""))}),l.onNodeChange.add(function(e,t,n){var o;n=e.selection.getStart(),o=e.dom.getParent(n,"td,th,caption"),t.setActive("table","TABLE"===n.nodeName||!!o),o&&"CAPTION"===o.nodeName&&(o=0),t.setDisabled("delete_table",!o),t.setDisabled("delete_col",!o),t.setDisabled("delete_table",!o),t.setDisabled("delete_row",!o),t.setDisabled("col_after",!o),t.setDisabled("col_before",!o),t.setDisabled("row_after",!o),t.setDisabled("row_before",!o),t.setDisabled("row_props",!o),t.setDisabled("cell_props",!o),t.setDisabled("split_cells",!o),t.setDisabled("merge_cells",!o)}),l.onInit.add(function(n){function l(t){if(e.isWebKit){var n=t.selection.getRng(),o=t.selection.getNode(),l=t.dom.getParent(n.startContainer,"TD,TH");if(function(e,t,n,o){var l,r,a,c=e.dom.getParent(t.startContainer,"TABLE");return c&&(l=c.parentNode),r=3==t.startContainer.nodeType&&0==t.startOffset&&0==t.endOffset&&o&&("TR"==n.nodeName||n==l),a=("TD"==n.nodeName||"TH"==n.nodeName)&&!o,r||a}(t,n,o,l)){l||(l=o);for(var r=l.lastChild;r.lastChild;)r=r.lastChild;n.setEnd(r,r.nodeValue.length),t.selection.setRng(n)}}}function r(){var t;for(t=n.getBody().lastChild;t&&3==t.nodeType&&!t.nodeValue.length;t=t.previousSibling);t&&"TABLE"==t.nodeName&&(n.settings.forced_root_block?n.dom.add(n.getBody(),n.settings.forced_root_block,null,e.isIE&&!e.isIE11?"&nbsp;":'<br data-mce-bogus="1" />'):n.dom.add(n.getBody(),"br",{"data-mce-bogus":"1"}))}var f,u,m,b=n.dom;i=n.windowManager,n.onMouseDown.add(function(e,t){2!=t.button&&(c(),u=b.getParent(t.target,"td,th"),f=b.getParent(u,"table"))}),b.bind(n.getDoc(),"mouseover",function(e){var t,o,l=e.target;if(u&&(m||l!=u)&&("TD"==l.nodeName||"TH"==l.nodeName)){(o=b.getParent(l,"table"))==f&&(m||((m=a(o)).setStartCell(u),n.getBody().style.webkitUserSelect="none"),m.setEndCell(l),s=!0),t=n.selection.getSel();try{t.removeAllRanges?t.removeAllRanges():t.empty()}catch(e){}e.preventDefault()}}),n.onMouseUp.add(function(t,n){function o(t,n){var o=new e.dom.TreeWalker(t,t);do{if(3==t.nodeType&&0!=e.trim(t.nodeValue).length)return void(n?l.setStart(t,0):l.setEnd(t,t.nodeValue.length));if("BR"==t.nodeName)return void(n?l.setStartBefore(t):l.setEndBefore(t))}while(t=n?o.next():o.prev())}var l,r,a,c,i,d=t.selection;d.getSel();if(u){if(m&&(t.getBody().style.webkitUserSelect=""),(r=b.select("td.mceSelected,th.mceSelected")).length>0){l=b.createRng(),c=r[0],r[r.length-1],l.setStartBefore(c),l.setEndAfter(c),o(c,1),a=new e.dom.TreeWalker(c,b.getParent(r[0],"table"));do{if("TD"==c.nodeName||"TH"==c.nodeName){if(!b.hasClass(c,"mceSelected"))break;i=c}}while(c=a.next());o(i),d.setRng(l)}t.nodeChanged(),u=m=f=null}}),n.onKeyUp.add(function(e,t){c()}),n.onKeyDown.add(function(e,t){l(e)}),n.onMouseDown.add(function(e,t){2!=t.button&&l(e)}),n.plugins.table.fixTableCellSelection=l,n&&n.plugins.contextmenu&&n.plugins.contextmenu.onContextMenu.add(function(e,t,o){var l,r=n.selection.getNode()||n.getBody();n.dom.getParent(o,"td")||n.dom.getParent(o,"th")||n.dom.select("td.mceSelected,th.mceSelected").length?(t.removeAll(),"A"!=r.nodeName||n.dom.getAttrib(r,"name")||(t.add({title:"advanced.link_desc",icon:"link",cmd:n.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),t.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"}),t.addSeparator()),"IMG"==r.nodeName&&-1==r.className.indexOf("mceItem")&&(t.add({title:"advanced.image_desc",icon:"image",cmd:n.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),t.addSeparator()),t.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}}),t.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"}),t.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"}),t.addSeparator(),(l=t.addMenu({title:"table.cell"})).add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"}),l.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"}),l.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"}),(l=t.addMenu({title:"table.row"})).add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"}),l.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"}),l.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"}),l.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"}),l.addSeparator(),l.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"}),l.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"}),l.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!d),l.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!d),(l=t.addMenu({title:"table.col"})).add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"}),l.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"}),l.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})):t.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}),e.isWebKit&&n.onKeyDown.add(function(n,l){function r(t,o,l){var d=t?"previousSibling":"nextSibling",s=n.dom.getParent(o,"tr"),f=s[d];if(f)return i(n,o,f,t),e.dom.Event.cancel(l),!0;var u=n.dom.getParent(s,"table"),m=s.parentNode,b=m.nodeName.toLowerCase();if("tbody"===b||b===(t?"tfoot":"thead")){var g=function(e,t,o,l){var r=n.dom.select(">"+l,t),a=r.indexOf(o);if(e&&0===a||!e&&a===r.length-1)return function(e,t){var o=e?"thead":"tfoot",l=n.dom.select(">"+o,t);return 0!==l.length?l[0]:null}(e,t);if(-1===a){var c="thead"===o.tagName.toLowerCase()?0:r.length-1;return r[c]}return r[a+(e?-1:1)]}(t,u,m,"tbody");if(null!==g)return function(t,o,l,r){var c=a(o,t);return c&&i(n,l,c,t),e.dom.Event.cancel(r),!0}(t,g,o,l)}return function(t,o,l,i,d){var s=i[l];if(s)return c(s),!0;var f=n.dom.getParent(i,"td,th");if(f)return r(t,f,d);var u=a(o,!t);return c(u),e.dom.Event.cancel(d)}(t,s,d,u,l)}function a(e,t){var o=e&&e[t?"lastChild":"firstChild"];return o&&"BR"===o.nodeName?n.dom.getParent(o,"td,th"):o}function c(e){n.selection.setCursorLocation(e,0)}function i(e,n,l,r){var i=function(e,n){var l=0,r=0;return o(e.children,function(e,o){if(l+=t(e,"colspan"),r=o,l>n)return!1}),r}(l,function(e){for(var n=0,o=e;o.previousSibling;)n+=t(o=o.previousSibling,"colspan");return n}(e.dom.getParent(n,"td,th"))),d=l.childNodes[i];c(a(d,r)||d)}function d(e){var t=n.selection.getNode(),o=n.dom.getParent(t,"td,th"),l=n.dom.getParent(e,"td,th");return o&&o!==l&&function(e,t){return n.dom.getParent(e,"TABLE")===n.dom.getParent(t,"TABLE")}(o,l)}var s=e.VK,f=l.keyCode;if((f==s.UP||f==s.DOWN)&&function(e){var t=e.selection.getNode();return null!==e.dom.getParent(t,"tr")}(n)){var u=n.selection.getNode();setTimeout(function(){d(u)&&r(!l.shiftKey&&f===s.UP,u,l)},0)}}),e.isGecko&&n.onKeyDown.add(function(e,t){var n,o,l=e.dom;37!=t.keyCode&&38!=t.keyCode||(n=e.selection.getRng(),(o=l.getParent(n.startContainer,"table"))&&e.getBody().firstChild==o&&function(e,t){var n,o=t.ownerDocument,l=o.createRange();return l.setStartBefore(t),l.setEnd(e.endContainer,e.endOffset),(n=o.createElement("body")).appendChild(l.cloneContents()),0==n.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length}(n,o)&&((n=l.createRng()).setStartBefore(o),n.setEndBefore(o),e.selection.setRng(n),t.preventDefault()))}),n.onKeyUp.add(r),n.onSetContent.add(r),n.onVisualAid.add(r),n.onPreProcess.add(function(e,t){var n=t.node.lastChild;n&&("BR"==n.nodeName||1==n.childNodes.length&&("BR"==n.firstChild.nodeName||" "==n.firstChild.nodeValue))&&n.previousSibling&&"TABLE"==n.previousSibling.nodeName&&e.dom.remove(n)}),r(),n.startContent=n.getContent({format:"raw"})}),o({mceTableSplitCells:function(e){e.split()},mceTableMergeCells:function(e){var t,n,o;(o=l.dom.getParent(l.selection.getNode(),"th,td"))&&(t=o.rowSpan,n=o.colSpan),l.dom.select("td.mceSelected,th.mceSelected").length?e.merge():i.open({url:r+"/merge_cells.htm",width:240+parseInt(l.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(l.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:t,cols:n,onaction:function(t){e.merge(o,t.cols,t.rows)},plugin_url:r})},mceTableInsertRowBefore:function(e){e.insertRow(!0)},mceTableInsertRowAfter:function(e){e.insertRow()},mceTableInsertColBefore:function(e){e.insertCol(!0)},mceTableInsertColAfter:function(e){e.insertCol()},mceTableDeleteCol:function(e){e.deleteCols()},mceTableDeleteRow:function(e){e.deleteRows()},mceTableCutRow:function(e){d=e.cutRows()},mceTableCopyRow:function(e){d=e.copyRows()},mceTablePasteRowBefore:function(e){e.pasteRows(d,!0)},mceTablePasteRowAfter:function(e){e.pasteRows(d)},mceTableDelete:function(e){e.deleteTable()}},function(e,t){l.addCommand(t,function(){var t=a();t&&(e(t),l.execCommand("mceRepaint"),c())})}),o({mceInsertTable:function(e){i.open({url:r+"/table.htm",width:400+parseInt(l.getLang("table.table_delta_width",0)),height:320+parseInt(l.getLang("table.table_delta_height",0)),inline:1},{plugin_url:r,action:e?e.action:0})},mceTableRowProps:function(){i.open({url:r+"/row.htm",width:400+parseInt(l.getLang("table.rowprops_delta_width",0)),height:295+parseInt(l.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:r})},mceTableCellProps:function(){i.open({url:r+"/cell.htm",width:400+parseInt(l.getLang("table.cellprops_delta_width",0)),height:295+parseInt(l.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:r})}},function(e,t){l.addCommand(t,function(t,n){e(n)})})}}),e.PluginManager.add("table",e.plugins.TablePlugin)}(tinymce);
