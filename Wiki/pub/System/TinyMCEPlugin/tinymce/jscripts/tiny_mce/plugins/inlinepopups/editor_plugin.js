!function(){var e=tinymce.DOM,t=tinymce.dom.Element,i=tinymce.dom.Event,n=tinymce.each,s=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(t,i){t.onBeforeRenderUI.add(function(){t.windowManager=new tinymce.InlineWindowManager(t),e.loadCSS(i+"/skins/"+(t.settings.inlinepopups_skin||"clearlooks2")+"/window.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(e){this.parent(e),this.zIndex=3e5,this.count=0,this.windows={}},open:function(n,s){var a,o,c,d,r,l,m,h=this,u="",f=h.editor,p=0,w=0;return n=n||{},s=s||{},n.inline?((m=h._frontWindow())&&e.get(m.id+"_ifr")&&(m.focussedElement=e.get(m.id+"_ifr").contentWindow.document.activeElement),n.type||(h.bookmark=f.selection.getBookmark(1)),a=e.uniqueId("mce_inlinepopups_"),o=e.getViewPort(),n.width=parseInt(n.width||320),n.height=parseInt(n.height||240)+(tinymce.isIE?8:0),n.min_width=parseInt(n.min_width||150),n.min_height=parseInt(n.min_height||100),n.max_width=parseInt(n.max_width||2e3),n.max_height=parseInt(n.max_height||2e3),n.left=n.left||Math.round(Math.max(o.x,o.x+o.w/2-n.width/2)),n.top=n.top||Math.round(Math.max(o.y,o.y+o.h/2-n.height/2)),n.movable=n.resizable=!0,s.mce_width=n.width,s.mce_height=n.height,s.mce_inline=!0,s.mce_window_id=a,s.mce_auto_focus=n.auto_focus,h.features=n,h.params=s,h.onOpen.dispatch(h,n,s),n.type&&(u+=" mceModal",n.type&&(u+=" mce"+n.type.substring(0,1).toUpperCase()+n.type.substring(1)),n.resizable=!1),n.statusbar&&(u+=" mceStatusbar"),n.resizable&&(u+=" mceResizable"),n.minimizable&&(u+=" mceMinimizable"),n.maximizable&&(u+=" mceMaximizable"),n.movable&&(u+=" mceMovable"),h._addAll(e.doc.body,["div",{id:a,role:"dialog","aria-labelledby":n.type?a+"_content":a+"_title",class:(f.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:a+"_wrapper",class:"mceWrapper"+u},["div",{id:a+"_top",class:"mceTop"},["div",{class:"mceLeft"}],["div",{class:"mceCenter"}],["div",{class:"mceRight"}],["span",{id:a+"_title"},n.title||""]],["div",{id:a+"_middle",class:"mceMiddle"},["div",{id:a+"_left",class:"mceLeft",tabindex:"0"}],["span",{id:a+"_content"}],["div",{id:a+"_right",class:"mceRight",tabindex:"0"}]],["div",{id:a+"_bottom",class:"mceBottom"},["div",{class:"mceLeft"}],["div",{class:"mceCenter"}],["div",{class:"mceRight"}],["span",{id:a+"_status"},"Content"]],["a",{class:"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{class:"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{class:"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{class:"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{class:"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:a+"_resize_n",class:"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_s",class:"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_w",class:"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_e",class:"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_nw",class:"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_ne",class:"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_sw",class:"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:a+"_resize_se",class:"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]),e.setStyles(a,{top:-1e4,left:-1e4}),tinymce.isGecko&&e.setStyle(a,"overflow","auto"),n.type||(p+=e.get(a+"_left").clientWidth,p+=e.get(a+"_right").clientWidth,w+=e.get(a+"_top").clientHeight,w+=e.get(a+"_bottom").clientHeight),e.setStyles(a,{top:n.top,left:n.left,width:n.width+p,height:n.height+w}),(l=n.url||n.file)&&(tinymce.relaxedDomain&&(l+=(-1==l.indexOf("?")?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),l=tinymce._addVer(l)),n.type?(e.add(a+"_wrapper","a",{id:a+"_ok",class:"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok"),"confirm"==n.type&&e.add(a+"_wrapper","a",{class:"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel"),e.add(a+"_middle","div",{class:"mceIcon"}),e.setHTML(a+"_content",n.content.replace("\n","<br />")),i.add(a,"keyup",function(e){if(27===e.keyCode)return n.button_func(!1),i.cancel(e)}),i.add(a,"keydown",function(t){var n;if(9===t.keyCode)return(n=e.select("a.mceCancel",a+"_wrapper")[0])&&n!==t.target?n.focus():e.get(a+"_ok").focus(),i.cancel(t)})):(e.add(a+"_content","iframe",{id:a+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),e.setStyles(a+"_ifr",{width:n.width,height:n.height}),e.setAttrib(a+"_ifr","src",l)),c=i.add(a,"mousedown",function(t){var n,s,o=t.target;if(n=h.windows[a],h.focus(a),"A"==o.nodeName||"a"==o.nodeName){if("mceClose"==o.className)return h.close(null,a),i.cancel(t);if("mceMax"==o.className)n.oldPos=n.element.getXY(),n.oldSize=n.element.getSize(),(s=e.getViewPort()).w-=2,s.h-=2,n.element.moveTo(s.x,s.y),n.element.resizeTo(s.w,s.h),e.setStyles(a+"_ifr",{width:s.w-n.deltaWidth,height:s.h-n.deltaHeight}),e.addClass(a+"_wrapper","mceMaximized");else if("mceMed"==o.className)n.element.moveTo(n.oldPos.x,n.oldPos.y),n.element.resizeTo(n.oldSize.w,n.oldSize.h),n.iframeElement.resizeTo(n.oldSize.w-n.deltaWidth,n.oldSize.h-n.deltaHeight),e.removeClass(a+"_wrapper","mceMaximized");else{if("mceMove"==o.className)return h._startDrag(a,t,o.className);if(e.hasClass(o,"mceResize"))return h._startDrag(a,t,o.className.substring(13))}}}),d=i.add(a,"click",function(e){var t=e.target;if(h.focus(a),"A"==t.nodeName||"a"==t.nodeName)switch(t.className){case"mceClose":return h.close(null,a),i.cancel(e);case"mceButton mceOk":case"mceButton mceCancel":return n.button_func("mceButton mceOk"==t.className),i.cancel(e)}}),i.add([a+"_left",a+"_right"],"focus",function(t){var i=e.get(a+"_ifr");if(i){var n=i.contentWindow.document.body,s=e.select(":input:enabled,*[tabindex=0]",n);t.target.id===a+"_left"?s[s.length-1].focus():s[0].focus()}else e.get(a+"_ok").focus()}),(r=h.windows[a]={id:a,mousedown_func:c,click_func:d,element:new t(a,{blocker:1,container:f.getContainer()}),iframeElement:new t(a+"_ifr"),features:n,deltaWidth:p,deltaHeight:w}).iframeElement.on("focus",function(){h.focus(a)}),0==h.count&&"modal"==h.editor.getParam("dialog_type","modal")?(e.add(e.doc.body,"div",{id:"mceModalBlocker",class:(h.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:h.zIndex-1}}),e.show("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","true")):e.setStyle("mceModalBlocker","z-index",h.zIndex-1),(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceModalBlocker",{position:"absolute",left:o.x,top:o.y,width:o.w-2,height:o.h-2}),e.setAttrib(a,"aria-hidden","false"),h.focus(a),h._fixIELayout(a,1),e.get(a+"_ok")&&e.get(a+"_ok").focus(),h.count++,r):h.parent(n,s)},focus:function(t){var i;(i=this.windows[t])&&(i.zIndex=this.zIndex++,i.element.setStyle("zIndex",i.zIndex),i.element.update(),t+="_wrapper",e.removeClass(this.lastId,"mceFocus"),e.addClass(t,"mceFocus"),this.lastId=t,i.focussedElement?i.focussedElement.focus():e.get(t+"_ok")?e.get(i.id+"_ok").focus():e.get(i.id+"_ifr")&&e.get(i.id+"_ifr").focus())},_addAll:function(e,t){var i,n=tinymce.DOM;if(s(t,"string"))e.appendChild(n.doc.createTextNode(t));else if(t.length)for(e=e.appendChild(n.create(t[0],t[1])),i=2;i<t.length;i++)this._addAll(e,t[i])},_startDrag:function(n,s,a){function o(){r||(b._fixIELayout(n,0),e.add(k.body,"div",{id:"mceEventBlocker",class:"mceEventBlocker "+(b.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:b.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!e.boxModel)&&e.setStyles("mceEventBlocker",{position:"absolute",left:f.x,top:f.y,width:f.w-2,height:f.h-2}),(r=new t("mceEventBlocker")).update(),l=M.getXY(),m=M.getSize(),p=u.x+l.x-f.x,w=u.y+l.y-f.y,e.add(r.get(),"div",{id:"mcePlaceHolder",class:"mcePlaceHolder",style:{left:p,top:w,width:m.w,height:m.h}}),h=new t("mcePlaceHolder"))}var c,d,r,l,m,h,u,f,p,w,_,g,y,v,x,z,b=this,k=e.doc,I=b.windows[n],M=I.element;M.getXY();return u={x:0,y:0},f=e.getViewPort(),f.w-=2,f.h-=2,_=s.screenX,g=s.screenY,y=v=x=z=0,c=i.add(k,"mouseup",function(t){return i.remove(k,"mouseup",c),i.remove(k,"mousemove",d),r&&r.remove(),M.moveBy(y,v),M.resizeBy(x,z),m=M.getSize(),e.setStyles(n+"_ifr",{width:m.w-I.deltaWidth,height:m.h-I.deltaHeight}),b._fixIELayout(n,1),i.cancel(t)}),"Move"!=a&&o(),d=i.add(k,"mousemove",function(e){var t,n,s;switch(o(),t=e.screenX-_,n=e.screenY-g,a){case"ResizeW":y=t,x=0-t;break;case"ResizeE":x=t;break;case"ResizeN":case"ResizeNW":case"ResizeNE":"ResizeNW"==a?(y=t,x=0-t):"ResizeNE"==a&&(x=t),v=n,z=0-n;break;case"ResizeS":case"ResizeSW":case"ResizeSE":"ResizeSW"==a?(y=t,x=0-t):"ResizeSE"==a&&(x=t),z=n;break;case"mceMove":y=t,v=n}return x<(s=I.features.min_width-m.w)&&(0!==y&&(y+=x-s),x=s),z<(s=I.features.min_height-m.h)&&(0!==v&&(v+=z-s),z=s),x=Math.min(x,I.features.max_width-m.w),z=Math.min(z,I.features.max_height-m.h),y=Math.max(y,f.x-(p+f.x)),v=Math.max(v,f.y-(w+f.y)),y=Math.min(y,f.w+f.x-(p+m.w+f.x)),v=Math.min(v,f.h+f.y-(w+m.h+f.y)),y+v!==0&&(p+y<0&&(y=0),w+v<0&&(v=0),h.moveTo(p+y,w+v)),x+z!==0&&h.resizeTo(m.w+x,m.h+z),i.cancel(e)}),i.cancel(s)},resizeBy:function(e,t,i){var n=this.windows[i];n&&(n.element.resizeBy(e,t),n.iframeElement.resizeBy(e,t))},close:function(t,n){var s,a,o=e.doc;n=this._findId(n||t),this.windows[n]?(this.count--,0==this.count&&(e.remove("mceModalBlocker"),e.setAttrib(e.doc.body,"aria-hidden","false"),this.editor.focus()),(s=this.windows[n])&&(this.onClose.dispatch(this),i.remove(o,"mousedown",s.mousedownFunc),i.remove(o,"click",s.clickFunc),i.clear(n),i.clear(n+"_ifr"),e.setAttrib(n+"_ifr","src",'javascript:""'),s.element.remove(),delete this.windows[n],(a=this._frontWindow())&&this.focus(a.id))):this.parent(t)},_frontWindow:function(){var e,t=0;return n(this.windows,function(i){i.zIndex>t&&(e=i,t=i.zIndex)}),e},setTitle:function(t,i){var n;t=this._findId(t),(n=e.get(t+"_title"))&&(n.innerHTML=e.encode(i))},alert:function(t,i,n){var s,a=this;s=a.open({title:a,type:"alert",button_func:function(e){i&&i.call(e||a,e),a.close(null,s.id)},content:e.encode(a.editor.getLang(t,t)),inline:1,width:400,height:130})},confirm:function(t,i,n){var s,a=this;s=a.open({title:a,type:"confirm",button_func:function(e){i&&i.call(e||a,e),a.close(null,s.id)},content:e.encode(a.editor.getLang(t,t)),inline:1,width:400,height:130})},_findId:function(t){return"string"==typeof t?t:(n(this.windows,function(i){var n=e.get(i.id+"_ifr");if(n&&t==n.contentWindow)return t=i.id,!1}),t)},_fixIELayout:function(t,i){var s;tinymce.isIE6&&(n(["n","s","w","e","nw","ne","sw","se"],function(n){var s=e.get(t+"_resize_"+n);e.setStyles(s,{width:i?s.clientWidth:"",height:i?s.clientHeight:"",cursor:e.getStyle(s,"cursor",1)}),e.setStyle(t+"_bottom","bottom","-1px"),s=0}),(s=this.windows[t])&&(s.element.hide(),s.element.show(),n(e.select("div,a",t),function(e,t){"none"!=e.currentStyle.backgroundImage&&((new Image).src=e.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),e.get(t).style.filter=""))}}),tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)}();
