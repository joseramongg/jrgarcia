!function(){function e(e,t){for(;e&&(8===e.nodeType||3===e.nodeType&&/^[ \t\n\r]*$/.test(e.nodeValue));)e=t(e);return e}function t(t){return e(t,function(e){return e.previousSibling})}function n(t){return e(t,function(e){return e.nextSibling})}function i(e,t,n){return e.dom.getParent(t,function(e){return-1!==tinymce.inArray(n,e)})}function o(e){return e&&("OL"===e.tagName||"UL"===e.tagName)}function r(e,n){var i,r,a;for(i=t(e.lastChild);o(i);)i=t((r=i).previousSibling);return r&&(a=n.create("li",{style:"list-style-type: none;"}),n.split(e,r),n.insertAfter(a,r),a.appendChild(r),a.appendChild(r),e=a.previousSibling),e}function a(e,n,i){return e=function(e,n,i){var o=t(e.previousSibling);return o?s(o,e,!!n&&o,i):e}(e,n,i),d(e,n,i)}function d(e,t,i){var o=n(e.nextSibling);return o?s(e,o,!!t&&o,i):e}function s(e,i,r,a){return function(e,i,r,a){return!(!e||!i)&&("LI"===e.tagName&&"LI"===i.tagName?"none"===i.style.listStyleType||l(i):o(e)?e.tagName===i.tagName&&(r||e.style.listStyleType===i.style.listStyleType)||function(e){var i=n(e.firstChild),r=t(e.lastChild);return i&&r&&o(e)&&i===r&&(o(i)||"none"===i.style.listStyleType||l(i))}(i):a&&"P"===e.tagName&&"P"===i.tagName)}(e,i,!!r,a)?function(e,i,o){var r=t(e.lastChild),a=n(i.firstChild);"P"===e.tagName&&e.appendChild(e.ownerDocument.createElement("br"));for(;i.firstChild;)e.appendChild(i.firstChild);o&&(e.style.listStyleType=o.style.listStyleType);return i.parentNode.removeChild(i),s(r,a,!1),e}(e,i,r):(e&&"LI"===e.tagName&&o(i)&&e.appendChild(i),i)}function l(e){var i=n(e.firstChild),r=t(e.lastChild);return i&&r&&i===r&&o(i)}function c(e,t){var n;return t.is(e,"li,ol,ul")||(n=t.getParent(e,"li"))&&(e=n),e}var u,f=tinymce.each,m=tinymce.dom.Event;tinymce.create("tinymce.plugins.Lists",{init:function(e){function t(){var e=n(),t=e.parentNode.parentNode;return e.parentNode.lastChild===e&&!function(e){return o(e)?e.parentNode&&"LI"===e.parentNode.tagName:"LI"===e.tagName}(t)&&i(e)}function n(){var t=e.selection.getStart();return"BR"!=t.tagName&&""!=t.tagName||"LI"!=t.parentNode.tagName?t:t.parentNode}function i(e){var t=e.childNodes.length;return"LI"===e.tagName&&(0==t||1==t&&(""==e.firstChild.tagName||"BR"==e.firstChild.tagName||function(e){var t=tinymce.grep(e.parentNode.childNodes,function(e){return"LI"==e.tagName}),n=e==t[t.length-1],i=e.firstChild;return tinymce.isIE9&&n&&(i.nodeValue==String.fromCharCode(160)||i.nodeValue==String.fromCharCode(32))}(e)))}function r(e){return e.keyCode===tinymce.VK.ENTER}function a(e){return r(e)&&!e.shiftKey}function d(o){return function(t){return t.keyCode===tinymce.VK.TAB&&!(t.altKey||t.ctrlKey)&&(e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList"))}(o)?c:a(o)&&t()?g:a(o)&&e.selection.isCollapsed()&&i(n())?u:g}function s(){var t=e.selection.getNode(),n=e.dom.is(t,"h1,h2,h3,h4,h5,h6,p,div")&&"LI"===t.parentNode.tagName&&t.parentNode.lastChild===t;return e.selection.isCollapsed()&&n&&function(){var t=e.selection.getRng(!0),n=t.startContainer;if(3==n.nodeType){var i=n.nodeValue;return tinymce.isIE9&&i.length>1&&32==i.charCodeAt(i.length-1)?t.endOffset==i.length-1:t.endOffset==i.length}return 1==n.nodeType&&t.endOffset==n.childNodes.length}()}function l(t,n){var i=e.getDoc().createTextNode("\ufeff");t.insertBefore(i,n),e.selection.setCursorLocation(i,0),e.execCommand("mceRepaint")}var c="TABBING",u="EMPTY",f="ESCAPE",g="UNKNOWN",p=g;this.ed=e,e.addCommand("Indent",this.indent,this),e.addCommand("Outdent",this.outdent,this),e.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),e.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),e.onInit.add(function(){e.editorCommands.addCommands({outdent:function(){function t(t){return(t=i.getParent(t,i.isBlock))&&parseInt(e.dom.getStyle(t,"margin-left")||0,10)+parseInt(e.dom.getStyle(t,"padding-left")||0,10)>0}var n=e.selection,i=e.dom;return t(n.getStart())||t(n.getEnd())||e.queryCommandState("InsertOrderedList")||e.queryCommandState("InsertUnorderedList")}},"state")}),e.onKeyUp.add(function(t,i){if(p==c)return t.execCommand(i.shiftKey?"Outdent":"Indent",!0,null),p=g,m.cancel(i);if(p==u){var o=n(),r=!0===t.settings.list_outdent_on_enter||i.shiftKey;return t.execCommand(r?"Outdent":"Indent",!0,null),tinymce.isIE&&function(t){var n=e.dom.getParent(t,"ol,ul");if(null!=n){var i=n.lastChild;e.selection.setCursorLocation(i,0)}}(o),m.cancel(i)}if(p==f)if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var a=t.getDoc().createTextNode("\ufeff");t.selection.getNode().appendChild(a)}else if(tinymce.isIE9||tinymce.isGecko)return t.execCommand("Outdent"),m.cancel(i)}),e.onKeyDown.add(function(e,t){p=d(t)}),e.onKeyDown.add(function(e,t){(p==c||p==u||tinymce.isGecko&&p==f)&&m.cancel(t)}),e.onKeyDown.add(function(e,t){var n;if(tinymce.isGecko){var i=e.selection.getStart();if(t.keyCode==tinymce.VK.BACKSPACE&&"IMG"===i.tagName&&(n=i.parentNode.previousSibling)){var o;if("UL"===n.tagName||"OL"===n.tagName)o=n;else{if(!n.previousSibling||"UL"!==n.previousSibling.tagName&&"OL"!==n.previousSibling.tagName)return;o=n.previousSibling}var r=function(e){var t=e.firstChild,n=null;do{if(!t)break;"LI"===t.tagName&&(n=t)}while(t=t.nextSibling);return n}(o),a=e.dom.createRng();a.setStart(r,1),a.setEnd(r,1),e.selection.setRng(a),e.selection.collapse(!0);var d=e.selection.getBookmark(),s=i.parentNode.cloneNode(!0);"P"===s.tagName||"DIV"===s.tagName?function(e,t){for(;e.childNodes.length>0;)t.appendChild(e.childNodes[0])}(s,r):r.appendChild(s),i.parentNode.parentNode.removeChild(i.parentNode),e.selection.moveToBookmark(d)}}}),e.onKeyDown.add(function(e,t){if(a(t)&&s()){var n=e.selection.getNode(),i=e.dom.create("li"),o=e.dom.getParent(n,"li");e.dom.insertAfter(i,o),tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8?e.selection.setCursorLocation(i,1):e.selection.setCursorLocation(i,0),t.preventDefault()}}),tinymce.isGecko&&e.onKeyUp.add(function(e,t){if(r(t)){var i=n();if(i){var o=i.parentNode,a=o&&o.parentNode;a&&"LI"==a.nodeName&&a.firstChild==o&&i==o.firstChild&&l(a,o)}}}),tinymce.isIE8&&e.onKeyUp.add(function(e,t){if(r(t)){var i=n();1===e.dom.select("ul li",i).length&&l(i,i.firstChild)}}),(tinymce.isGecko||tinymce.isWebKit)&&e.onKeyDown.add(function(e,t){if(t.keyCode==tinymce.VK.BACKSPACE){var i=n();if(i){var o=e.dom.getParent(i,"ol,ul"),r=e.selection.getRng();if(o&&o.firstChild===i&&0==r.startOffset){var a=function(t){for(var n=[],i=new tinymce.dom.TreeWalker(t.firstChild,t),o=i.current();o;o=i.next())e.dom.is(o,"ol,ul,li")&&n.push(o);return n}(i);return a.unshift(i),e.execCommand("Outdent",!1,a),e.undoManager.add(),m.cancel(t)}}}}),tinymce.isWebKit&&e.onKeyDown.add(function(e,t){var i=n();if(t.keyCode===tinymce.VK.BACKSPACE&&e.dom.is(i,"li")&&i.parentNode.firstChild!==i&&1===e.dom.select("ul,ol",i).length){var o=i.previousSibling;e.dom.remove(e.dom.select("br",i)),e.dom.remove(i,!0);var r=tinymce.grep(o.childNodes,function(e){return 3===e.nodeType});if(1===r.length){var a=r[0];e.selection.setCursorLocation(a,a.length)}return e.undoManager.add(),m.cancel(t)}})},applyList:function(e,t){function n(e){e&&"BR"===e.tagName&&h.remove(e)}function i(t){function i(e){(e.style.marginLeft||e.style.paddingLeft)&&g.adjustPaddingFunction(!1)(e)}var r,d=h.create(e);if("LI"===t.tagName);else{if("P"===t.tagName||"DIV"===t.tagName||"BODY"===t.tagName)return s(t,function(e,a){o(e,a,"BODY"===t.tagName?null:e.parentNode),i(r=e.parentNode),n(a)}),void(r&&("LI"===r.tagName&&("P"===t.tagName||S.length>1)&&h.split(r.parentNode.parentNode,r.parentNode),a(r.parentNode,!0)));r=h.create("li"),h.insertAfter(r,t),r.appendChild(t),i(t),t=r}h.insertAfter(d,t),d.appendChild(t),a(d,!0),N.push(t)}function o(e,t,n){for(var o,r,a=e;!h.isBlock(e.parentNode)&&e.parentNode!==h.getRoot();)a=e=(e=h.split(e.parentNode,e.previousSibling)).nextSibling;if(n){for(o=n.cloneNode(!0),e.parentNode.insertBefore(o,e);o.firstChild;)h.remove(o.firstChild);o=h.rename(o,"li")}else o=h.create("li"),e.parentNode.insertBefore(o,e);for(;a&&a!=t;)r=a.nextSibling,o.appendChild(a),a=r;0===o.childNodes.length&&(o.innerHTML='<br _mce_bogus="1" />'),i(o)}function s(e,t){function n(e,t){var n,i=h.createRng();return u.keep=!0,p.selection.moveToBookmark(u),u.keep=!1,n=p.selection.getRng(!0),t||(t=e.parentNode.lastChild),i.setStartBefore(e),i.setEndAfter(t),!(i.compareBoundaryPoints(a,n)>0||i.compareBoundaryPoints(d,n)<=0)}function i(e){return e.nextSibling?e.nextSibling:h.isBlock(e.parentNode)||e.parentNode===h.getRoot()?void 0:i(e.parentNode)}var o,r,a=3,d=1,s="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";o=e.firstChild;var l=!1;f(h.select(s,e),function(e){if(e.hasAttribute&&e.hasAttribute("_mce_bogus"))return!0;n(o,e)&&(h.addClass(e,"_mce_tagged_br"),o=i(e))}),l=o&&n(o,void 0),o=e.firstChild,f(h.select(s,e),function(e){var n=i(e);if(e.hasAttribute&&e.hasAttribute("_mce_bogus"))return!0;h.hasClass(e,"_mce_tagged_br")?(t(o,e,r),r=null):r=e,o=n}),l&&t(o,void 0,r)}function l(e){s(e,function(e,t,i){o(e,t),n(t),n(i)})}var m,g=this,p=g.ed,h=p.dom,N=[],y=!1,C=!1,v=!1,S=p.selection.getSelectedBlocks();f(S,function(n){(n=c(n,h)).tagName===t||"LI"===n.tagName&&n.parentNode.tagName===t?C=!0:n.tagName===e||"LI"===n.tagName&&n.parentNode.tagName===e?y=!0:v=!0}),m=v&&!y||C||0===S.length?{LI:function(e){-1===tinymce.inArray(N,e)&&(e.parentNode.tagName===t&&(h.split(e.parentNode,e),i(e),d(e.parentNode,!1)),N.push(e))},H1:i,H2:i,H3:i,H4:i,H5:i,H6:i,P:i,BODY:i,DIV:S.length>1?i:l,defaultAction:l,elements:this.selectedBlocks()}:{defaultAction:function(e){var t,n,i;if(-1===tinymce.inArray(N,e)){for(e=r(e,h);h.is(e.parentNode,"ol,ul,li");)h.split(e.parentNode,e);if(N.push(e),e=h.rename(e,"p"),a(e,!1,p.settings.force_br_newlines)===e)for(t=e.firstChild;t;)h.isBlock(t)?(i=!0,n=(t=h.split(t.parentNode,t)).nextSibling&&t.nextSibling.firstChild):(n=t.nextSibling,i&&"BR"===t.tagName&&h.remove(t),i=!1),t=n}},elements:this.selectedBlocks(),processEvenIfEmpty:!0},this.process(m)},indent:function(){function e(e){var t,i=function(e){var t=n.create("li",{style:"list-style-type: none;"});return n.insertAfter(t,e),t}(e),o=n.getParent(e,"ol,ul"),r=o.tagName,a=n.getStyle(o,"list-style-type"),d={};return""!==a&&(d.style="list-style-type: "+a+";"),t=n.create(r,d),i.appendChild(t),t}var t=this.ed,n=t.dom,o=[];this.process({LI:function(d){if(!i(t,d,o)){var s=e(d=r(d,n));s.appendChild(d),a(s.parentNode,!1),a(s,!1),o.push(d)}},defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(e,t){var n=this,o=n.ed,d=o.dom,s=[],l=t&&tinymce.is(t,"array")?t:this.selectedBlocks();this.process({LI:function(e){var t,a,l;if(!i(o,e,s)){if(""!==d.getStyle(e,"margin-left")||""!==d.getStyle(e,"padding-left"))return n.adjustPaddingFunction(!1)(e);if("center"===(l=d.getStyle(e,"text-align",!0))||"right"===l)return void d.setStyle(e,"text-align","left");t=(e=r(e,d)).parentNode,"P"===(a=e.parentNode.parentNode).tagName?d.split(a,e.parentNode):(d.split(t,e),"LI"===a.tagName?d.split(a,e):d.is(a,"ol,ul")||d.rename(e,"p")),s.push(e)}},defaultAction:this.adjustPaddingFunction(!1),elements:l}),f(s,a)},process:function(e){function t(t){if(d.removeClass(t,"_mce_act_on"),t&&1===t.nodeType&&!(!e.processEvenIfEmpty&&i.length>1&&function(e){return 0===tinymce.grep(e.childNodes,function(e){return!("BR"===e.nodeName||"SPAN"===e.nodeName&&"bookmark"==d.getAttrib(e,"data-mce-type")||3==e.nodeType&&(e.nodeValue==String.fromCharCode(160)||""==e.nodeValue))}).length}(t))){t=c(t,d);var n=e[t.tagName];n||(n=e.defaultAction),n(t)}}function n(e,t){return t>=0&&e.hasChildNodes()&&t<e.childNodes.length&&"BR"===e.childNodes[t].tagName}var i,o,r=this,a=r.ed.selection,d=r.ed.dom;if(i=e.elements,(o=a.getRng(!0)).collapsed||(n(o.endContainer,o.endOffset-1)&&(o.setEnd(o.endContainer,o.endOffset-1),a.setRng(o)),n(o.startContainer,o.startOffset)&&(o.setStart(o.startContainer,o.startOffset+1),a.setRng(o))),tinymce.isIE8){var s=r.ed.selection.getNode();if("LI"===s.tagName&&s.parentNode.lastChild!==s){var l=r.ed.getDoc().createTextNode("\ufeff");s.appendChild(l)}}u=a.getBookmark(),e.OL=e.UL=function(e){r.splitSafeEach(e.childNodes,t,!0)},r.splitSafeEach(i,t),a.moveToBookmark(u),u=null,function(){var e=a.getNode();return null!==d.getParent(e,"td")}()||r.ed.execCommand("mceRepaint")},splitSafeEach:function(e,t,n){n||tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(e,t):f(e,t)},classBasedEach:function(e,t){var n,i,o=this.ed.dom;for(f(e,function(e){o.addClass(e,"_mce_act_on")}),n=o.select("._mce_act_on");n.length>0;)i=n.shift(),o.removeClass(i,"_mce_act_on"),t(i),n=o.select("._mce_act_on")},adjustPaddingFunction:function(e){var t,n,i=this.ed;return t=i.settings.indentation,n=/[a-z%]+/i.exec(t),t=parseInt(t,10),function(o){var r,a;r=parseInt(i.dom.getStyle(o,"margin-left")||0,10)+parseInt(i.dom.getStyle(o,"padding-left")||0,10),a=e?r+t:r-t,i.dom.setStyle(o,"padding-left",""),i.dom.setStyle(o,"margin-left",a>0?a+n:"")}},selectedBlocks:function(){var e=this.ed,t=e.selection.getSelectedBlocks();return 0==t.length?[e.dom.getRoot()]:t},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)}();
