var Types={};!function($){"use strict";Types.BaseType=Class.extend({null_if:null,init:function(e){this.spec=e},createUI:function(e){var t,s,i,u,r,n=this.spec.current_value;return void 0===n&&(n=""),this.spec.SIZE&&(t=this.spec.SIZE.match(/^\s*(\d+)x(\d+)(\s|$)/))?(s=t[1],i=t[2],u=(u=void 0===n?"":n).replace(/&/g,"&amp;"),this.$ui=$('<textarea id="'+_id_ify(this.spec.keys)+'" rows="'+i+'" cols="'+s+'" class="foswikiTextArea">'+u+"</textarea>")):(r=80,this.spec.SIZE&&(t=this.spec.SIZE.match(/^\s*(\d+)(\s|$)/))&&(r=t[1]),this.$ui=$('<input type="text" id="'+_id_ify(this.spec.keys)+'" size="'+r+'"/>'),this.useVal(n)),this.spec.SPELLCHECK&&this.$ui.prop("spellcheck",!0),void 0!==e&&this.$ui.change(e),this.$ui},useVal:function(e){this.$ui.val(e)},currentValue:function(){return null!==this.null_if&&this.null_if()?null:this.$ui.val()},commitVal:function(){this.spec.current_value=this.currentValue()},restoreCurrentValue:function(){this.useVal(this.spec.current_value)},restoreDefaultValue:function(){this.useVal(this.spec.default)},isModified:function(){var e=this.spec.current_value;return void 0===e&&(e=null===this.null_if?"":null),this.currentValue()!=e},isDefault:function(){return this.currentValue()==this.spec.default}}),Types.STRING=Types.BaseType.extend({restoreDefaultValue:function(){var e=this.spec.default;e="undef"===e?null:e.replace(/^\s*(["'])(.*)\1\s*$/,"$2"),this.useVal(e)},isDefault:function(){var e=this.spec.default;return"string"==typeof e&&/^\s*'.*'\s*$/.test(e)&&(e=(e=e.replace(/^\s*'(.*)'\s*$/,"$1")).replace(/\'/g,"'")),this.currentValue()===e}}),Types.BOOLEAN=Types.BaseType.extend({createUI:function(e){return this.$ui=$('<input type="checkbox" id="'+_id_ify(this.spec.keys)+'" />'),void 0!==e&&this.$ui.change(e),void 0===this.spec.current_value?this.spec.current_value=0:"0"==this.spec.current_value?this.spec.current_value=0:"1"==this.spec.current_value&&(this.spec.current_value=1),0!==this.spec.current_value&&this.$ui.prop("checked",!0),this.spec.extraClass&&this.$ui.addClass(this.spec.extraClass),this.$ui},currentValue:function(){return this.$ui[0].checked?1:0},isModified:function(){return this.currentValue()!=this.spec.current_value},isDefault:function(){var a=this.currentValue(),b=eval(this.spec.default);return a==b},useVal:function(e){void 0===e?e=!1:"0"==e||"$FALSE"==e?e=!1:"1"==e&&(e=!0),this.$ui.prop("checked",e)}}),Types.PASSWORD=Types.STRING.extend({createUI:function(e){return this._super(e),this.$ui.attr("type","password"),this.$ui.prop("autocomplete",!1),this.$ui}}),Types.REGEX=Types.STRING.extend({restoreDefaultValue:function(){var e=this.spec.default;e=(e="undef"===e?null:e.replace(/^\s*(["'])(.*)\1\s*$/,"$2")).replace(/\\\\\\/,"\\"),this.useVal(e)},isDefault:function(){var e=this.spec.default;return"string"==typeof e&&/^\s*'.*'\s*$/.test(e)&&(e=(e=(e=e.replace(/^\s*'(.*)'\s*$/,"$1")).replace(/\'/g,"'")).replace(/\\\\\\/,"\\")),this.currentValue()===e}}),Types.deep_equals=function(e,t){if(e===t)return!0;if(null===e||void 0===e||null===t||void 0===t)return!1;if(e.constructor!==t.constructor)return!1;if(e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(!(e instanceof Object&&t instanceof Object))return!1;var s=Object.keys(e);return Object.keys(t).every(function(e){return-1!==s.indexOf(e)})&&s.every(function(s){return Types.deep_equals(e[s],t[s])})},Types.PERL=Types.BaseType.extend({createUI:function(e){return this.spec.SIZE&&this.spec.SIZE.match(/\b(\d+)x(\d+)\b/)||(this.spec.SIZE="80x20"),this._super(e)},isDefault:function(){var a=this.currentValue(),b=this.spec.default,av,bv;a=null==a?null:a.trim(),b=null==b?null:b.trim();try{av=eval(a),bv=eval(b)}catch(e){av=null,bv=null}return null!==av&&null!==bv?Types.deep_equals(av,bv):a===b}}),Types.NUMBER=Types.BaseType.extend({createUI:function(e){return this._super(function(t){var s=$(this).val();/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/.test(s)?($(this).css("background-color",""),e.call(this,t)):($(this).css("background-color","yellow"),alert('"'+s+'" is not a valid number'))})}}),Types.OCTAL=Types.NUMBER.extend({createUI:function(e){return this._super(function(t){var s=$(this).val();/^[0-7]+$/.test(s)?($(this).css("background-color",""),e.call(this,t)):($(this).css("background-color","yellow"),alert('"'+s+'" is not a valid octal number'))})}}),Types.PATHINFO=Types.STRING.extend({createUI:function(e){return this._super(e),this.$ui.prop("readonly",!0),this.$ui}}),Types.PATH=Types.STRING.extend({}),Types.URL=Types.STRING.extend({}),Types.URILIST=Types.STRING.extend({}),Types.URLPATH=Types.STRING.extend({}),Types.DATE=Types.STRING.extend({}),Types.COMMAND=Types.STRING.extend({}),Types.EMAILADDRESS=Types.STRING.extend({}),Types.NULL=Types.BaseType.extend({createUI:function(e){return this._super(e),this.$ui.prop("readonly",!0),this.$ui.prop("disabled",!0),this.$ui.attr("size","1"),this.$ui}}),Types.BUTTON=Types.BaseType.extend({createUI:function(){return this.$ui=$('<a href="'+this.spec.uri+'">'+this.spec.title+"</a>"),this.$ui.button(),this.$ui},useVal:function(){}}),Types.SELECT=Types.BaseType.extend({_getSel:function(e,t){var s,i,u={};if(void 0!==e)if(t)for(s=e.split(","),i=0;i<s.length;i++)u[s[i]]=!0;else u[e]=!0;return u},createUI:function(e){var t,s,i,u,r,n=1;if(this.spec.SIZE&&(t=this.spec.SIZE.match(/\b(\d+)\b/))&&(n=t[0]),this.$ui=$('<select id="'+_id_ify(this.spec.keys)+'" size="'+n+'" class="foswikiSelect" />'),void 0!==e&&this.$ui.change(e),this.spec.MULTIPLE&&this.$ui.prop("multiple",!0),void 0!==this.spec.select_from)for(s=this._getSel(this.spec.current_value,this.spec.MULTIPLE),i=0;i<this.spec.select_from.length;i++)u=this.spec.select_from[i],r=$("<option>"+u+"</option>"),s[u]&&r.prop("selected",!0),this.$ui.append(r);return this.$ui},useVal:function(e){e=e.replace(/^\s*(["'])(.*?)\1\s*/,"$2");var t,s=this._getSel(e),i=this.spec.select_from;void 0!==i&&(t=0,this.$ui.find("option").each(function(){var e=i[t++];s[e]?$(this).prop("selected",!0):$(this).prop("selected",!1)}))},isDefault:function(){var e=this.currentValue(),t=this.spec.default;return e=null==e?null:e.trim(),t=null==t?null:t.trim(),t=t.replace(/^\s*(["'])(.*?)\1\s*/,"$2"),e===t}}),Types.SELECTCLASS=Types.SELECT.extend({})}(jQuery);
