!function(t){function e(e,n){this.elem=t(e),this.opts=t.extend({},s,n),this.init()}var s={split:1,numStars:5};e.prototype._toFixed=function(t){return t=Number(t),Number(t.toFixed(this._prec))},e.prototype.init=function(){var e,s,n=this;n.mapping={},n.opts.values&&(!function(t){return t.constructor===String}(n.opts.values)?function(t){return t.constructor===Array}(n.opts.values)&&(s=[],t.each(n.opts.values,function(t,i){if(function(t){return t.constructor===Object}(i))for(e in i)n.mapping[i[e]]=e,s.push(i[e]);else s.push(i)}),n.opts.values=s):n.opts.values=n.opts.values.split(/\s*,\s*/),n.opts.numStars=n.opts.values.length,n.opts.split=1),n._prec=0,n.opts.split>1&&n._prec++,n.opts.split>10&&n._prec++,n.opts.split>100&&n._prec++,n.blockMouseMove=!1,n.timeoutId=void 0,n.elem.hide(),n.container=t("<div />").addClass("jqStarsContainer").insertAfter(n.elem),n.labelElem=t("<span />").addClass("jqStarsLabel").insertAfter(n.container),n.onElem=t("<div />").addClass("jqStarsOn").appendTo(n.container),n.widthStar=parseInt(n.container.css("background-size"),10),n.width=n.opts.numStars*n.widthStar,n.container.width(n.width),n.elem.is(":disabled")?n.container.addClass("jqStarsReadOnly"):(n.deleteElem=t("<div />").addClass("jqStarsDelete").insertAfter(n.elem),n.container.on("mousemove",function(t){n.blockMouseMove||n.displayAtIndex((t.pageX-n.container.offset().left)/n.widthStar)}),n.container.on("mouseleave",function(){n.blockMouseMove&&(void 0!==n.timeoutId&&window.clearTimeout(n.timeoutId),n.timeoutId=window.setTimeout(function(){n.blockMouseMove=!1,n.timeoutId=void 0},1e3)),n.display(n.elem.val()),n.container.removeClass("jqStarsSelected")}),n.container.on("mouseenter",function(){n.blockMouseMove=!1}),n.container.on("click",function(t){return n.displayAtIndex((t.pageX-n.container.offset().left)/n.widthStar),n.container.addClass("jqStarsSelected"),n.blockMouseMove=!0,n.selectAtIndex(n._tmpIndex),!1}),n.deleteElem.hover(function(){n.display()},function(){n.display(n.elem.val())}),n.deleteElem.on("click",function(){return n.select(),!1}),n.container.on("mousewheel",function(t){var e=1/n.opts.split;return t.deltaY>0?(n._tmpIndex+=e,n._tmpIndex>n.opts.numStars&&(n._tmpIndex=n.opts.numStars)):(n._tmpIndex-=e,n._tmpIndex<0&&(n._tmpIndex=0)),n._tmpIndex=n._toFixed(n._tmpIndex),n.selectAtIndex(n._tmpIndex),n.container.addClass("jqStarsSelected"),n.blockMouseMove=!0,!1})),n.select(n.elem.val())},e.prototype.getDisplayVal=function(t){var e;return this.opts.values?(e=this.opts.values[t-1],void 0!==this.mapping[e]&&(e=this.mapping[e])):e=sprintf("%."+this._prec+"f",t),e},e.prototype.displayAtIndex=function(t){var e,s,n=this;void 0===t||0===t?(e=0,s=""):(t=Math.ceil(t*n.opts.split)/n.opts.split,t=n._toFixed(t),e=n.widthStar*t,s=n.getDisplayVal(t)),t!=n._tmpIndex&&(n.onElem.width(e),n.labelElem.html(s),n._tmpIndex=t,n.elem.trigger("display.stars",t,s))},e.prototype.display=function(t){var e;e=void 0===t||""===t||0==t?void 0:void 0!==this.opts.values?this.opts.values.indexOf(t)+1:t,this.displayAtIndex(e)},e.prototype.selectAtIndex=function(t){var e;this._tmpIndex=void 0,e=void 0===t||0===t?"":void 0!==this.opts.values?this.opts.values[t-1]:t,this.displayAtIndex(t),this.elem.val(e)},e.prototype.select=function(t){this._tmpIndex=void 0,this.display(t),this.elem.val(t)},t.fn.stars=function(s){return this.each(function(){t.data(this,"_stars")||t.data(this,"_stars",new e(this,s))})},t(function(){t(".jqStars:not(.jqInitedStars)").livequery(function(){var e=t(this),s=t.extend({},e.data(),e.metadata());e.wrap("<div class='jqStars jqInitedStars' />").removeClass("jqStars").addClass("jqStarsInput").stars(s)})})}(jQuery);
