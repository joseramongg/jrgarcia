!function(e){ChiliBook={version:"2.2",automatic:!0,automaticSelector:"code",lineNumbers:!1,codeLanguage:function(r){var n=e(r).attr("class");return n||""},recipeLoading:!0,recipeFolder:"",replaceSpace:"&#160;",replaceTab:"&#160;&#160;&#160;&#160;",replaceNewLine:"&#160;<br/>",selectionStyle:["position:absolute; z-index:3000; overflow:scroll;","width:16em;","height:9em;","border:1px solid gray;","padding:15px;","background-color:yellow;"].join(" "),defaultReplacement:'<span class="$0">$$</span>',recipes:{},queue:{},unique:function(){return(new Date).valueOf()}},e.fn.chili=function(r){function n(r,t,a){function l(e,r,n){var t=e[r][n],i="string"==typeof t._match?t._match:t._match.source;return{recipe:e,blockName:r,stepName:n,exp:"("+i+")",length:1+(i.replace(/\\./g,"%").replace(/\[.*?\]/g,"%").match(/\((?!\?)/g)||[]).length,replacement:t._replace?t._replace:c.defaultReplacement}}function o(e){for(var r=1,n=[],i=0;i<e.length;i++){var a=e[i].exp;a=a.replace(/\\\\|\\(\d+)/g,function(e,n){return n?"\\"+(r+1+parseInt(n,10)):e}),n.push(a),r+=e[i].length}var c="(?:"+n.join("|")+")";return c="((?:\\s|\\S)*?)"+c+"|((?:\\s|\\S)+)",new RegExp(c,t._case?"g":"gi")}function u(e){return e=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;")}(e),g&&(e=function(e){return e.replace(/ +/g,function(e){return e.replace(/ /g,g)})}(e)),e}function p(r,t,a){function s(e){var r=i(e),n=c.recipes[r];if(!n)throw{msg:"recipe not available"};return n}if(!t)return u(r);var g=t.split("/"),h="",d="",v="";switch(g.length){case 1:h=g[0];break;case 2:h=g[0],d=g[1];break;case 3:h=g[0],d=g[1],v=g[2];break;default:return u(r)}try{var m;if(""!=v)return m=""==h?a.recipe:s(h),""==d&&(d=a.blockName),d in m&&v in m[d]?function(e,r,n,t){c.replaceSpace;var i=[l(r,n,t)];return e.replace(o(i),function(){return f.apply({steps:i},arguments)})}(r,m,d,v):u(r);if(""!=d)return m=""==h?a.recipe:s(h),d in m?function(e,r,t){return n(e,r,t)}(r,m,d):u(r);if(""!=h)return m=s(h),function(e,r){return n(e,r)}(r,m)}catch(n){if(n.msg&&"recipe not available"==n.msg){var b="chili_"+c.unique();if(c.recipeLoading){var w=i(h);if(c.queue[w])c.queue[w].push({cue:b,subject:r,module:t,context:a});else try{c.queue[w]=[{cue:b,subject:r,module:t,context:a}],e.ajax({url:w,dataType:"text",success:function(r){c.recipes[w]=window.eval("(function() { var recipe = "+r+"; return recipe; }())");for(var n=c.queue[w],t=0,i=n.length;t<i;t++){var a=p(n[t].subject,n[t].module,n[t].context);c.replaceTab&&(a=a.replace(/\t/g,c.replaceTab)),c.replaceNewLine&&(a=a.replace(/\n/g,c.replaceNewLine)),e("#"+n[t].cue).replaceWith(a)}}})}catch(e){alert("the recipe for '"+h+"' was not found in '"+w+"'")}return'<span id="'+b+'">'+u(r)+"</span>"}return u(r)}return u(r)}}function s(e,r){return r.replace(/(<span\s+class\s*=\s*(["']))((?:(?!__)\w)+\2\s*>)/gi,"$1"+e+"__$3")}function f(){if(!arguments[0])return"";var r=this.steps,n=0,t=2,i=arguments[1],a=arguments[arguments.length-3];if(a)return u(a);for(var c;c=r[n++];){var l=arguments;if(l[t]){var o="";if(e.isFunction(c.replacement)){for(var f=[],g=0,h=c.length;g<h;g++)f.push(l[t+g]);f.push(l[l.length-2]),f.push(l[l.length-1]),o=c.replacement.apply({x:function(){return p(arguments[0],arguments[1],{recipe:c.recipe,blockName:c.blockName})}},f)}else o=c.replacement.replace(/(\\\$)|(?:\$\$)|(?:\$(\d+))/g,function(e,r,n){return r?"$":n?"0"==n?c.stepName:u(l[t+parseInt(n,10)]):u(l[t])});return o=s(c.recipe._name,o),u(i)+o}t+=c.length}}if(a||(a="_main",function(e){var r=e._name;if(!c.queue[r]){var n=["/* Chili -- "+r+" */"];for(var t in e)if(t.search(/^_(?!main\b)/)<0)for(var i in e[t]){var a=e[t][i];if("_style"in a)if(a._style.constructor==String)n.push("."+r+"__"+i+" { "+a._style+" }");else for(var l in a._style)n.push("."+r+"__"+l+" { "+a._style[l]+" }")}(function(e){if(document.createElement){var r=document.createElement("style");if(r.type="text/css",r.styleSheet)r.styleSheet.cssText=e;else{var n=document.createTextNode(e);r.appendChild(n)}document.getElementsByTagName("head")[0].appendChild(r)}})(n=n.join("\n")),c.queue[r]=!0}}(t)),!(a in t))return u(r);var g=c.replaceSpace,h=function(e,r){var n=[];for(var t in e[r])n.push(l(e,r,t));return n}(t,a),d=o(h);return r.replace(d,function(){return f.apply({steps:h},arguments)})}function t(r,t){var i=c.recipes[t];if(i){var l=e(r),o=l.text();if(o){o=o.replace(/\r\n?/g,"\n"),l.parent().is("pre")&&(e.browser.safari||(o=o.replace(/^\n/g,"")));var u=n(o,i);c.replaceTab&&(u=u.replace(/\t/g,c.replaceTab)),c.replaceNewLine&&(u=u.replace(/\n/g,c.replaceNewLine)),r.innerHTML=u,(e.browser.msie||e.browser.mozilla)&&function(r){var n=null;e(r).parents().filter("pre").bind("mousedown",function(){n=this,e.browser.msie?document.selection.empty():window.getSelection().removeAllRanges()}).bind("mouseup",function(r){if(n&&n==this){n=null;var t="";if(e.browser.msie){if(""==(t=document.selection.createRange().htmlText))return;t=function(r){do{var n=ChiliBook.unique()}while(r.indexOf(n)>-1);var t="";if(/<br/i.test(r)||/<li/i.test(r)){/<br/i.test(r)?r=r.replace(/\<br[^>]*?\>/gi,n):/<li/i.test(r)&&(r=r.replace(/<ol[^>]*?>|<\/ol>|<li[^>]*?>/gi,"").replace(/<\/li>/gi,n));var i=e("<pre>").appendTo("body").hide()[0];i.innerHTML=r,t=e(i).text().replace(new RegExp(n,"g"),"\r\n"),e(i).remove()}return t}(t);var i='<textarea style="STYLE">'}else{if(""==(t=window.getSelection().toString()))return;t=t.replace(/\r/g,"").replace(/^# ?/g,"").replace(/\n# ?/g,"\n");var i='<pre style="STYLE">'}var a=e(i.replace(/\bSTYLE\b/,ChiliBook.selectionStyle)).appendTo("body").text(t).attr("id","chili_selection").click(function(){e(this).remove()}),c=r.pageY-Math.round(a.height()/2)+"px",l=r.pageX-Math.round(a.width()/2)+"px";if(a.css({top:c,left:l}),e.browser.msie)a[0].focus(),a[0].select();else{var o=window.getSelection();o.removeAllRanges();var u=document.createRange();u.selectNodeContents(a[0]),o.addRange(u)}}})}(r);var p=l.parent(),s=p.attr("class"),f=/ln-(\d+)-([\w][\w\-]*)|ln-(\d+)|ln-/.exec(s);if(f){a(r);var g=0;if(f[1]){g=parseInt(f[1],10);var h=e(".ln-"+f[1]+"-"+f[2]),d=h.index(p[0]);h.slice(0,d).each(function(){g+=e(this).find("li").length})}else g=f[3]?parseInt(f[3],10):1;l.find("ol")[0].start=g,e("body").width(e("body").width()-1).width(e("body").width()+1)}else c.lineNumbers&&a(r)}}}function i(e){return c.recipeFolder+e+".js"}function a(r){function n(e,r,n,t){var i=t?"</span>":"",a="";return e?a="<li>"+t+r+i+"</li>":n&&(a="<li>"+t+n+i+"</li>"),a}var t=e(r).html(),i=/<br>/.test(t)?"<br>":"<BR>",a="<li>"+c.replaceSpace+"</li>",l=t.replace(/(<span [^>]+>)((?:(?:&nbsp;|\xA0)<br>)+)(.*?)(<\/span>)/gi,"$2$1$3$4").replace(/(.*?)(<span .*?>)(.*?)(?:<\/span>(?:&nbsp;|\xA0)<br>|<\/span>)/gi,function(e,r,t,a){if(/<br>/i.test(a)){var c=r.split(i),l=c.pop();return((r=c.join(i))?r+i:"")+(l+a).replace(/((.*?)(?:&nbsp;|\xA0)<br>)|(.*)/gi,function(e,r,i,a){return n(r,i,a,t)})}return e}).replace(/(<li>.*?<\/li>)|((.*?)(?:&nbsp;|\xA0)<br>)|(.+)/gi,function(e,r,t,i,a){return function(e,r,t,i){return i||n(e,r,t,"")}(t,i,a,r)}).replace(/<li><\/li>/gi,a);r.innerHTML="<ol>"+l+"</ol>"}var c=e.extend({},ChiliBook,r||{});return this.each(function(){var r=e(this);r.trigger("chili.before_coloring"),function(r){var n=c.codeLanguage(r);if(""!=n){var a=i(n);if(c.recipeLoading){if(c.queue[a])c.queue[a].push(r);else try{c.queue[a]=[r],e.ajax({url:a,dataType:"text",success:function(e){c.recipes[a]=window.eval("(function() { var recipe = "+e+"; return recipe; }())");for(var r=c.queue[a],n=0,i=r.length;n<i;n++)t(r[n],a)}})}catch(e){alert("the recipe for '"+n+"' was not found in '"+a+"'")}t(r,a)}else t(r,a)}}(this),r.trigger("chili.after_coloring")}),this}}(jQuery);
