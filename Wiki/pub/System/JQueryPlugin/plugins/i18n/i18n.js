"use strict";!function(t){var e,n=function(){var e=this;e.messageStore={},e.currentLanguage=t("html").attr("lang")||"en",t('script[type="application/l10n"]').livequery(function(){var n,a=t(this),r=a.attr("src"),o=a.data("i18nLanguage"),i=a.data("i18nNamespace");void 0===r?(n=t.parseJSON(a.text()),e.addResource(n,o,i),e.translateAllElements()):e.loadResource(r,o,i)}),t(".i18n:not(.i18nTranslated)").livequery(function(){e.translateElement(this)}),t("html").on("change",function(){var n=t(this).attr("lang")||"en";n!==e.currentLanguage&&e.changeLanguage(n)})};n.prototype.loadResource=function(e,n,a){var r=this;t.getJSON(e).done(function(t){r.addResource(t,n,a),r.translateAllElements()}).fail(function(t,n,a){console&&console.error("error loading i18n dictionary from url "+e+", error: ",a)})},n.prototype.addResource=function(e,n,a){n=n||this.currentLanguage,a=a||"*",void 0===this.messageStore[n]&&(this.messageStore[n]={"*":{}}),this.messageStore[n][a]=t.extend(!0,this.messageStore[n][a],e)},n.prototype.translateAllElements=function(){var e=this;t(".i18n:not(.i18nTranslated)").each(function(){e.translateElement(this)})},n.prototype.translateElement=function(e){var n,a=t(e),r=a.data(),o=r.i18nMessage,i={};return t.each(r,function(t,e){t.match(/^i18n(.*)$/)&&"i18nMessage"!==t&&(t=RegExp.$1.toLowerCase(),i[t]=e)}),void 0===o&&(o=a.text()),void 0!==o&&(n=this.translate(o,i))!==o&&a.html(n).addClass("i18nTranslated"),a},n.prototype.translate=function(e,n){var a,r=this.messageStore[this.currentLanguage];return void 0!==r&&void 0===(a=r["*"][e])&&t.each(r,function(t,n){return"*"!==t&&(a=n[e]),void 0===a||""===a}),void 0!==a&&""!==a||(a=e),void 0!==n&&t.each(n,function(t,e){void 0!==t&&void 0!==e&&(a=a.replace("%"+t+"%",e))}),a},n.prototype.changeLanguage=function(t){this.currentLanguage=t,this.translateAllElements()},e=new n,t.i18n=function(t,n){return e.translate(t,n)}}(jQuery);
