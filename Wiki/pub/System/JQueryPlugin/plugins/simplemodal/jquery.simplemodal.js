!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){var o=[],t=e(document),i=e.browser.msie&&6===parseInt(e.browser.version)&&"object"!=typeof window.XMLHttpRequest,s=e.browser.msie&&7===parseInt(e.browser.version),n=null,a=e(window),d=[];e.modal=function(o,t){return e.modal.impl.init(o,t)},e.modal.close=function(){e.modal.impl.close()},e.modal.focus=function(o){e.modal.impl.focus(o)},e.modal.setContainerDimensions=function(){e.modal.impl.setContainerDimensions()},e.modal.setPosition=function(){e.modal.impl.setPosition()},e.modal.update=function(o,t){e.modal.impl.update(o,t)},e.fn.modal=function(o){return e.modal.impl.init(this,o)},e.modal.defaults={appendTo:"body",focus:!0,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1e3,close:!0,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:!0,overlayClose:!1,fixed:!0,position:null,persist:!1,modal:!0,onOpen:null,onShow:null,onClose:null},e.modal.impl={d:{},init:function(o,t){var i=this;if(i.d.data)return!1;if(n=e.browser.msie&&!e.boxModel,i.o=e.extend({},e.modal.defaults,t),i.zIndex=i.o.zIndex,i.occb=!1,"object"==typeof o)o=o instanceof jQuery?o:e(o),i.d.placeholder=!1,o.parent().parent().size()>0&&(o.before(e("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"})),i.d.placeholder=!0,i.display=o.css("display"),i.o.persist||(i.d.orig=o.clone(!0)));else{if("string"!=typeof o&&"number"!=typeof o)return alert("SimpleModal Error: Unsupported data type: "+typeof o),i;o=e("<div></div>").html(o)}return i.create(o),o=null,i.open(),e.isFunction(i.o.onShow)&&i.o.onShow.apply(i,[i.d]),i},create:function(t){var s=this;s.getDimensions(),s.o.modal&&i&&(s.d.iframe=e('<iframe src="javascript:false;"></iframe>').css(e.extend(s.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:d[0],width:d[1],zIndex:s.o.zIndex,top:0,left:0})).appendTo(s.o.appendTo)),s.d.overlay=e("<div></div>").attr("id",s.o.overlayId).addClass("simplemodal-overlay").css(e.extend(s.o.overlayCss,{display:"none",opacity:s.o.opacity/100,height:s.o.modal?o[0]:0,width:s.o.modal?o[1]:0,position:"fixed",left:0,top:0,zIndex:s.o.zIndex+1})).appendTo(s.o.appendTo),s.d.container=e("<div></div>").attr("id",s.o.containerId).addClass("simplemodal-container").css(e.extend({position:s.o.fixed?"fixed":"absolute"},s.o.containerCss,{display:"none",zIndex:s.o.zIndex+2})).append(s.o.close&&s.o.closeHTML?e(s.o.closeHTML).addClass(s.o.closeClass):"").appendTo(s.o.appendTo),s.d.wrap=e("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(s.d.container),s.d.data=t.attr("id",t.attr("id")||s.o.dataId).addClass("simplemodal-data").css(e.extend(s.o.dataCss,{display:"none"})).appendTo("body"),t=null,s.setContainerDimensions(),s.d.data.appendTo(s.d.wrap),(i||n)&&s.fixIE()},bindEvents:function(){var s=this;e("."+s.o.closeClass).bind("click.simplemodal",function(e){e.preventDefault(),s.close()}),s.o.modal&&s.o.close&&s.o.overlayClose&&s.d.overlay.bind("click.simplemodal",function(e){e.preventDefault(),s.close()}),t.bind("keydown.simplemodal",function(e){s.o.modal&&9===e.keyCode?s.watchTab(e):s.o.close&&s.o.escClose&&27===e.keyCode&&(e.preventDefault(),s.close())}),a.bind("resize.simplemodal orientationchange.simplemodal",function(){s.getDimensions(),s.o.autoResize?s.setContainerDimensions():s.o.autoPosition&&s.setPosition(),i||n?s.fixIE():s.o.modal&&(s.d.iframe&&s.d.iframe.css({height:d[0],width:d[1]}),s.d.overlay.css({height:o[0],width:o[1]}))})},unbindEvents:function(){e("."+this.o.closeClass).unbind("click.simplemodal"),t.unbind("keydown.simplemodal"),a.unbind(".simplemodal"),this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var o=this.o.position;e.each([this.d.iframe||null,this.o.modal?this.d.overlay:null,"fixed"===this.d.container.css("position")?this.d.container:null],function(e,t){if(t){var i="document.body.clientHeight",s="document.body.clientWidth",n="document.body.scrollHeight",a="document.body.scrollLeft",d="document.body.scrollTop",l="document.body.scrollWidth",r="document.documentElement.clientHeight",c="document.documentElement.clientWidth",p="document.documentElement.scrollLeft",h="document.documentElement.scrollTop",m=t[0].style;if(m.position="absolute",e<2)m.removeExpression("height"),m.removeExpression("width"),m.setExpression("height",n+" > "+i+" ? "+n+" : "+i+' + "px"'),m.setExpression("width",l+" > "+s+" ? "+l+" : "+s+' + "px"');else{var u,f;if(o&&o.constructor===Array){var v=o[0]?"number"==typeof o[0]?o[0].toString():o[0].replace(/px/,""):t.css("top").replace(/px/,"");if(u=-1===v.indexOf("%")?v+" + (t = "+h+" ? "+h+" : "+d+') + "px"':parseInt(v.replace(/%/,""))+" * (("+r+" || "+i+") / 100) + (t = "+h+" ? "+h+" : "+d+') + "px"',o[1]){var g="number"==typeof o[1]?o[1].toString():o[1].replace(/px/,"");f=-1===g.indexOf("%")?g+" + (t = "+p+" ? "+p+" : "+a+') + "px"':parseInt(g.replace(/%/,""))+" * (("+c+" || "+s+") / 100) + (t = "+p+" ? "+p+" : "+a+') + "px"'}}else u="("+r+" || "+i+") / 2 - (this.offsetHeight / 2) + (t = "+h+" ? "+h+" : "+d+') + "px"',f="("+c+" || "+s+") / 2 - (this.offsetWidth / 2) + (t = "+p+" ? "+p+" : "+a+') + "px"';m.removeExpression("top"),m.removeExpression("left"),m.setExpression("top",u),m.setExpression("left",f)}}})},focus:function(o){var t=this,i=o&&-1!==e.inArray(o,["first","last"])?o:"first",s=e(":input:enabled:visible:"+i,t.d.wrap);setTimeout(function(){s.length>0?s.focus():t.d.wrap.focus()},10)},getDimensions:function(){var i=e.browser.opera&&e.browser.version>"9.5"&&e.fn.jquery<"1.3"||e.browser.opera&&e.browser.version<"9.5"&&e.fn.jquery>"1.2.6"?a[0].innerHeight:a.height();o=[t.height(),t.width()],d=[i,a.width()]},getVal:function(e,o){return e?"number"==typeof e?e:"auto"===e?0:e.indexOf("%")>0?parseInt(e.replace(/%/,""))/100*("h"===o?d[0]:d[1]):parseInt(e.replace(/px/,"")):null},update:function(e,o){var t=this;if(!t.d.data)return!1;t.d.origHeight=t.getVal(e,"h"),t.d.origWidth=t.getVal(o,"w"),t.d.data.hide(),e&&t.d.container.css("height",e),o&&t.d.container.css("width",o),t.setContainerDimensions(),t.d.data.show(),t.o.focus&&t.focus(),t.unbindEvents(),t.bindEvents()},setContainerDimensions:function(){var o=this,t=i||s,n=o.d.origHeight?o.d.origHeight:e.browser.opera?o.d.container.height():o.getVal(t?o.d.container[0].currentStyle.height:o.d.container.css("height"),"h"),a=o.d.origWidth?o.d.origWidth:e.browser.opera?o.d.container.width():o.getVal(t?o.d.container[0].currentStyle.width:o.d.container.css("width"),"w"),l=o.d.data.outerHeight(!0),r=o.d.data.outerWidth(!0);o.d.origHeight=o.d.origHeight||n,o.d.origWidth=o.d.origWidth||a;var c=o.o.maxHeight?o.getVal(o.o.maxHeight,"h"):null,p=o.o.maxWidth?o.getVal(o.o.maxWidth,"w"):null,h=c&&c<d[0]?c:d[0],m=p&&p<d[1]?p:d[1],u=o.o.minHeight?o.getVal(o.o.minHeight,"h"):"auto";n=n?o.o.autoResize&&n>h?h:n<u?u:n:l?l>h?h:o.o.minHeight&&"auto"!==u&&l<u?u:l:u;var f=o.o.minWidth?o.getVal(o.o.minWidth,"w"):"auto";a=a?o.o.autoResize&&a>m?m:a<f?f:a:r?r>m?m:o.o.minWidth&&"auto"!==f&&r<f?f:r:f,o.d.container.css({width:a}),o.d.wrap.css({overflow:l>n||r>a?"auto":"visible"}),o.o.autoPosition&&o.setPosition()},setPosition:function(){var e,o,t=d[0]/2-this.d.container.outerHeight(!0)/2,i=d[1]/2-this.d.container.outerWidth(!0)/2,s="fixed"!==this.d.container.css("position")?a.scrollTop():0;this.o.position&&"[object Array]"===Object.prototype.toString.call(this.o.position)?(e=s+(this.o.position[0]||t),o=this.o.position[1]||i):(e=s+t,o=i),this.d.container.css({left:o,top:e})},watchTab:function(o){if(e(o.target).parents(".simplemodal-container").length>0){if(this.inputs=e(":input:enabled:visible:first, :input:enabled:visible:last",this.d.data[0]),!o.shiftKey&&o.target===this.inputs[this.inputs.length-1]||o.shiftKey&&o.target===this.inputs[0]||0===this.inputs.length){o.preventDefault();var t=o.shiftKey?"last":"first";this.focus(t)}}else o.preventDefault(),this.focus()},open:function(){this.d.iframe&&this.d.iframe.show(),e.isFunction(this.o.onOpen)?this.o.onOpen.apply(this,[this.d]):(this.d.overlay.show(),this.d.container.show(),this.d.data.show()),this.o.focus&&this.focus(),this.bindEvents()},close:function(){if(!this.d.data)return!1;if(this.unbindEvents(),e.isFunction(this.o.onClose)&&!this.occb)this.occb=!0,this.o.onClose.apply(this,[this.d]);else{if(this.d.placeholder){var o=e("#simplemodal-placeholder");this.o.persist?o.replaceWith(this.d.data.removeClass("simplemodal-data").css("display",this.display)):(this.d.data.hide().remove(),o.replaceWith(this.d.orig))}else this.d.data.hide().remove();this.d.container.hide().remove(),this.d.overlay.hide(),this.d.iframe&&this.d.iframe.hide().remove(),this.d.overlay.remove(),this.d={}}}}});
