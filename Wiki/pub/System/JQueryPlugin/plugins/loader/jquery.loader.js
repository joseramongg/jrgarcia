"use strict";jQuery(function(o){function e(e,n){var t=this;t.element=e,t.options=o.extend({},i,n),t.init(),"auto"===t.options.mode&&(t.options.delay?window.setTimeout(function(){t.load()},t.options.delay):t.load())}var i={mode:"auto",placeholder:"<img src='"+foswiki.getPreference("PUBURLPATH")+"/System/JQueryPlugin/images/spinner.gif' width='16' height='16' />",url:void 0,params:void 0,topic:void 0,section:void 0,skin:"text",select:void 0,minHeight:0,effect:"fade",effectspeed:500,effectopts:{},reloadAfter:0,delay:0,onload:function(){},finished:function(){},beforeload:function(){void 0!==this.container&&this.container.css({opacity:.5})}};e.prototype.init=function(){var e=this,i=o(e.element);i.bind("refresh.jqloader",function(i,n){o.extend(e.options,n),e.options.delay?window.setTimeout(function(){e.load()},e.options.delay):e.load()}),"function"==typeof e.options.onload&&i.bind("onload.jqloader",function(){e.options.onload.call(e)}),"function"==typeof e.options.beforeload&&i.bind("beforeload.jqloader",function(){e.options.beforeload.call(e)}),"function"==typeof e.options.finished&&i.bind("finished.jqloader",function(){e.options.finished.call(e)}),e.options.reloadAfter&&i.bind("finished.jqloader",function(){window.setTimeout(function(){e.load()},e.options.reloadAfter)}),e.prepareContainer()},e.prototype.prepareContainer=function(){var e,i=this,n=o(i.element);void 0!==i.options.placeholder&&""!==i.options.placeholder&&((e=o(decodeURI(i.options.placeholder)).hide()).insertBefore(n),n.bind("beforeload.jqloader",function(){e.show()}),n.bind("onload.jqloader",function(){e.hide()}),"auto"!==i.options.mode&&e.click(function(){n.trigger("refresh.jqloader",i)}))},e.prototype.load=function(){var e=this,i=o(e.element),n=e.options.web||foswiki.getPreference("WEB"),t=e.options.topic||foswiki.getPreference("TOPIC"),r=o.extend({},e.options.params);if(void 0===e.options.url&&(e.options.url=foswiki.getScriptUrl("view",n,t)),void 0!==e.options.section&&(r.section=e.options.section),void 0!==e.options.skin&&e.options.skin&&(r.skin=e.options.skin),i.trigger("beforeload.jqloader",e),!e.options.url)throw"error: no url";void 0===e.container&&(e.container=o("<div class='jqLoaderContainer' />").insertAfter(i),e.options.minHeight&&(e.container.css("min-height",e.options.minHeight),o(window).trigger("resize"))),o.get(e.options.url,r,function(n){void 0!==e.options.select&&(n=o(n).find(e.options.select)),e.container.remove(),e.container=o("<div class='jqLoaderContainer' />").insertAfter(i),e.options.minHeight&&(e.container.css("min-height",e.options.minHeight),o(window).trigger("resize")),e.container.append(n),i.trigger("onload.jqloader",e),void 0!==e.options.effect&&"show"!==e.options.effect?(e.container.hide(),"fade"===e.options.effect?e.container.fadeIn(e.options.effectspeed,function(){i.trigger("finished.jqloader",e)}):e.container.show(e.options.effect,e.options.effectopts,e.options.effectspeed,function(){i.trigger("finished.jqloader",e)})):i.trigger("finished.jqloader",e)},"html")},o.fn.jqLoader=function(i){return this.each(function(){o.data(this,"plugin_jqLoader")||o.data(this,"plugin_jqLoader",new e(this,i))})},o(".jqLoader:not(.jqLoaderInited)").livequery(function(){var e=o(this),i=o.extend({},e.data(),e.metadata());e.addClass("jqLoaderInited").jqLoader(i)})});
